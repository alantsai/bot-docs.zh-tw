---
title: 設計和控制對話流程 | Microsoft Docs
description: 了解如何設計和控制您 Bot 中的對話流程，以提供良好的使用者體驗。
keywords: 設計, 控制, 對話流程, 處理中斷, 概觀
author: v-ducvo
ms.author: v-ducvo
manager: kamrani
ms.topic: article
ms.service: bot-service
ms.subservice: sdk
ms.date: 12/19/2018
ms.openlocfilehash: 79c37a48f9312d60b61124e15780fe46236aa0c7
ms.sourcegitcommit: f7a8f05fc05ff4a7212a437d540485bf68831604
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 12/21/2018
ms.locfileid: "53735978"
---
::: moniker range="azure-bot-service-3.0"

# <a name="design-and-control-conversation-flow"></a>設計和控制對話流程

[!INCLUDE [pre-release-label](./includes/pre-release-label-v3.md)]

在傳統的應用程式中，使用者介面 (UI) 是一系列的畫面。 
單一應用程式或網站可以視需要，使用一個或多個畫面與使用者交換資訊。 
大部分的應用程式是以主畫面啟動，使用者在其中開始進入並提供導覽，以導向其他畫面來使用不同的功能，例如開始新的訂單、瀏覽產品或尋求協助。

如同應用程式和網站，Bot 具有使用者介面，不過是由**對話方塊**組成，而不是畫面。 對話方塊有助於保留您在對話內的位置，必要時提示使用者，以及執行輸入驗證。 很適合用於管理多回合對話和簡單的「表單型」資訊收集，以完成預訂班機等活動。

對話方塊可讓 Bot 開發人員以邏輯方式區隔 Bot 功能的各個區域，並引導對話式流程。 例如，您可能會設計一個包含可協助使用者瀏覽產品邏輯的對話方塊，以及一個包含可協助使用者建立新訂單的不同對話方塊。 

對話方塊不一定具有圖形化介面。 它們可能包含按鈕、文字和其他元素，或完全以語音為基礎。 對話方塊也包含可執行工作的動作，例如叫用其他對話方塊，或是處理使用者輸入。

## <a name="using-dialogs-to-manage-conversation-flow"></a>使用對話方塊來管理對話流程

[!INCLUDE [Dialog flow example](./includes/snippet-dotnet-manage-conversation-flow-intro.md)]

如需使用對話方塊和 Bot 建立器 SDK 來管理對話流程的詳細逐步解說，請參閱：

- [使用對話方塊來管理對話流程 (.NET)](./dotnet/bot-builder-dotnet-manage-conversation-flow.md)
- [使用對話方塊來管理對話流程 (Node.js)](./nodejs/bot-builder-nodejs-manage-conversation-flow.md)

## <a name="dialog-stack"></a>對話方塊堆疊

當一個對話方塊叫用另一個對話方塊時，Bot 建立器 會將新的對話方塊新增至對話方塊堆疊的頂端。 
堆疊頂端的對話方塊會控制對話。 
使用者所傳送的每個新訊息都必須由該對話方塊處理，直到關閉或重新導向至另一個對話方塊為止。 
當對話方塊關閉時，會從堆疊中移除，且堆疊中的前一個對話方塊會取得對話的控制權。 

> [!IMPORTANT]
> 若要能夠有效地設計 Bot 的對話流程，則了解在對話方塊互相叫用、關閉等等時，Bot 建立器如何建構及解構對話方塊堆疊的概念至關重要。 

## <a name="dialogs-stacks-and-humans"></a>對話方塊、堆疊和人類

您很自然地會想要假設假設使用者會建立對話方塊堆疊來巡覽對話方塊，且在某個時間點會巡覽回到他們的來源方向，以整齊而有條理的方式，依序將對話方塊取消堆疊。 
例如，使用者會從根對話方塊中開始，從該處叫用新的訂單對話方塊，並接著叫用產品搜尋對話方塊。 
然後使用者會結束 [產品搜尋] 對話方塊來選取產品並確認、結束 [新增訂單] 對話方塊來完成訂單，然後回到根對話方塊。 

雖然使用者一律經過這類線性、邏輯路徑的話會很棒，但這卻很少發生。 
人類不會以「堆疊」方式通訊。 他們通常會頻繁地改變心意。 
請思考下列範例： 

![Bot](./media/bot-service-design-conversation-flow/stack-issue.png)

雖然您的 Bot 可能會以邏輯方式建構對話方塊的堆疊，但使用者可能會決定要進行完全不同的事項，或是詢問可能與目前主題不相關的問題。 
在範例中，使用者會詢問問題，而不是提供對話方塊所預期的 [是]/[否] 回應。 
您的對話方塊應該如何回應？

- 堅持由使用者先回答問題。 
- 忽略使用者先前已完成的所有項目、重設整個對話方塊堆疊，並嘗試回答使用者的問題來從頭開始。 
- 嘗試回答使用者的問題，然後返回是/否問題，接著嘗試從該處繼續執行。 

這個問題沒有任何「正確」答案，因為最好的解決方案將取決於您案例的細節，以及使用者會如何合理預期 Bot 回應。 不過，隨著您的對話複雜度增加，**對話方塊**會變得更難管理。 在複雜分支的情況下，建立您自己的控制邏輯流程，可能比追蹤您的使用者對話更為輕鬆。

## <a name="next-steps"></a>後續步驟

透過讓使用者可以達成其目標 (即使以非線性的方式) 的方式來管理使用者的對話方塊瀏覽及設計對話流程，是 Bot 設計的基本挑戰。 
[下一篇文章](./bot-service-design-navigation.md)會檢閱一些常見的瀏覽設計不良錯誤，並討論避免這些陷阱的策略。 

::: moniker-end

::: moniker range="azure-bot-service-4.0"

# <a name="design-and-control-conversation-flow"></a>設計和控制對話流程

在傳統的應用程式中，使用者介面 (UI) 包含一系列的畫面，且單一應用程式或網站可以視需要使用一個或多個畫面與使用者交換資訊。
大部分的應用程式是以主畫面啟動，使用者在其中開始進入，該畫面會提供導覽，以導向其他畫面來使用不同的功能，例如開始新的訂單、瀏覽產品或尋求協助。

如同應用程式和網站，Bot 具有使用者介面，不過是由**訊息**組成，而不是畫面。 訊息可能包含按鈕、文字和其他元素，或完全以語音為基礎。

雖然傳統的應用程式或網站可以要求在畫面上一次顯示全部資訊，但 Bot 會使用多個訊息來收集相同數量的資訊。 如此一來，向使用者收集資訊的程序就是主動的體驗；使用者可在其中與 Bot 主動對話。

設計良好的 Bot 會有自然的對話流程。 Bot 應該能夠順暢地處理核心對話，且能夠正常地處理中斷或切換對話的主題。

## <a name="procedural-conversation-flow"></a>程序的對話流程

與 Bot 對話通常著重於 Bot 要嘗試達成的工作，也就是所謂的程序流程。 Bot 會在其中向使用者詢問一系列的問題，以收集在處理工作之前所需的所有資訊。

在程序對話流程中，您要定義問題的順序，且 Bot 會以您定義的順序來詢問問題。 您可以將問題組織成邏輯「模組」以保持程式碼集中，同時聚焦於引導對話。 例如，您可能會設計一個包含可協助使用者瀏覽產品邏輯的模組，以及一個包含可協助使用者建立新訂單邏輯的不同模組。

您可用任何偏好的方式來建構這些模組，從自由格式到循序方式皆可。 Bot 建立器 SDK 提供多個程式庫，可讓您建構 Bot 所需的任何對話式流程。 例如，`prompts` 程式庫可讓您要求使用者輸入，`waterfall` 程式庫可讓您定義問題/答案組的序列，`dialog control` 程式庫可讓您將對話流程邏輯模組化等等。這些程式庫全都會透過 `dialogs` 物件繫結在一起。 讓我們進一步看看模組會如何實作為 `dialogs` 來設計和管理對話流程，並查看該流程與傳統應用程式流程有何相似之處。

![Bot](./media/designing-bots/core/dialogs-screens.png)

在傳統的應用程式中，所有項目都是以**主畫面**開始。
**主畫面**會叫用**新訂單畫面**。
**新訂單畫面**會保持控制權，直到它關閉或叫用其他畫面 (例如**產品搜尋畫面**) 為止。
如果**新訂單畫面**關閉，使用者就會回到**主畫面**。

在 bot 中，所有項目都是以**根對話方塊**開頭。
**根對話方塊**會叫用**新訂單對話方塊**。
此時，**新訂單對話方塊**會接管對話，並保持控制權，直到它關閉或叫用其他對話方塊 (例如**產品搜尋對話方塊**) 為止。
如果**新訂單對話 (dialog)** 關閉，則會將對話 (conversation) 的控制權還給**根對話 (dialog)**。

如需如何實作交談流程的範例，請參閱如何[建立自己的提示以蒐集使用者輸入](./v4sdk/bot-builder-primitive-prompts.md)，並使用對話來[實作循序交談流程](./v4sdk/bot-builder-dialog-manage-conversation-flow.md)。

## <a name="handle-interruptions"></a>處理中斷

您很自然地會想要假設使用者會以整齊而有條理的方式，依序執行程序性工作。
例如，在使用 `dialogs` 的程序性對話流程中，使用者會從根對話方塊中開始，從該處叫用新訂單，並接著叫用產品搜尋對話方塊。 然後使用者會結束 [產品搜尋] 對話方塊來選取產品並確認、結束 [新增訂單] 對話方塊來完成訂單，然後回到根對話方塊。

雖然使用者一律經過這類線性、邏輯路徑的話會很棒，但這卻很少發生。
人類不會以循序 `dialogs` 方式通訊。 他們通常會頻繁地改變心意。
請思考下列範例：

![Bot](./media/bot-service-design-conversation-flow/stack-issue.png)

雖然您的 Bot 可能會以程序為中心，但使用者可能會決定要進行完全不同的事項，或是詢問可能與目前主題不相關的問題。
在上述範例中，使用者會詢問問題，而不是提供 Bot 所預期的 [是]/[否] 回應。
您的 Bot 應該如何回應？

- 堅持由使用者先回答問題。
- 忽略使用者先前已完成的所有項目、重設整個對話方塊堆疊，並嘗試回答使用者的問題來從頭開始。
- 嘗試回答使用者的問題，然後返回 [是]/[否] 問題，接著嘗試從該處繼續執行。

這個問題沒有任何「正確」答案，因為最好的解決方案將取決於您案例的細節，以及使用者會如何合理預期 Bot 回應。 如需詳細資訊，請參閱[處理使用者中斷](v4sdk/bot-builder-howto-handle-user-interrupt.md)。

## <a name="next-steps"></a>後續步驟

透過讓使用者可以達成其目標 (即使以非線性的方式) 的方式來管理使用者的對話方塊瀏覽及設計對話流程，是 Bot 設計的基本挑戰。
[下一篇文章](~/bot-service-design-navigation.md)會檢閱一些常見的瀏覽設計不良錯誤，並討論避免這些陷阱的策略。

::: moniker-end
